<!doctype html>
<html lang="en" class="h-full bg-neutral-950 antialiased">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Braven Lab Dashboard</title>
    <script src="/js/tailwind.js"></script>
    <script src="/js/lucide.min.js"></script>
    <style>
      @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 300;
        src: url("/fonts/inter-300.ttf") format("truetype");
      }
      @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 400;
        src: url("/fonts/inter-400.ttf") format("truetype");
      }
      @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 500;
        src: url("/fonts/inter-500.ttf") format("truetype");
      }
      @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 600;
        src: url("/fonts/inter-600.ttf") format("truetype");
      }
      @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 700;
        src: url("/fonts/inter-600.ttf") format("truetype");
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          fontFamily: {
            sans: ["Inter", "sans-serif"],
            mono: [
              "ui-monospace",
              "SFMono-Regular",
              "Menlo",
              "Monaco",
              "Consolas",
              "monospace",
            ],
          },
          extend: {
            colors: {
              karoo: { yellow: "#FFD700", purple: "#8B5CF6" },
            },
            keyframes: {
              pulsefast: {
                "0%, 100%": { opacity: "1" },
                "50%": { opacity: "0.4" },
              },
            },
            animation: {
              pulsefast: "pulsefast 2s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="h-full flex flex-col text-neutral-100 overflow-hidden selection:bg-karoo-yellow selection:text-black"
  >
    <!-- Compact Status Bar -->
    <header
      class="flex-none flex items-center justify-between px-6 py-2 border-b border-white/5 bg-neutral-900/30 backdrop-blur-xl z-10"
    >
      <div class="flex items-center gap-4">
        <div
          id="connectionBadge"
          class="flex items-center gap-2 px-3 py-1 rounded-full bg-red-500/10 border border-red-500/20"
        >
          <span class="relative flex h-2 w-2">
            <span
              id="pingDot"
              class="absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"
            ></span>
            <span
              id="solidDot"
              class="relative inline-flex rounded-full h-2 w-2 bg-red-500"
            ></span>
          </span>
          <span
            id="connectionText"
            class="text-xs font-medium text-red-500 tracking-wide uppercase"
            >Disconnected</span
          >
        </div>
        <h1 class="text-base font-medium text-neutral-500 tracking-tight">
          Braven Performance Lab
        </h1>
      </div>

      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-2 text-neutral-400">
          <i data-lucide="timer" class="w-4 h-4"></i>
          <span id="elapsedTime" class="font-semibold tabular-nums text-white"
            >00:00:00</span
          >
        </div>
        <div class="h-3 w-px bg-white/10"></div>
        <div class="flex items-center gap-2 text-neutral-500">
          <span>Lap</span>
          <span id="lapNumber" class="font-semibold text-amber-400 tabular-nums"
            >1</span
          >
          <span id="lapTime" class="tabular-nums text-white">00:00</span>
        </div>
        <div class="h-3 w-px bg-white/10"></div>
        <div class="flex items-center gap-2 text-neutral-400">
          <i data-lucide="map-pin" class="w-4 h-4"></i>
          <span id="distance" class="font-medium tabular-nums text-white"
            >0.00 km</span
          >
        </div>
        <div class="h-3 w-px bg-white/10"></div>
        <div class="flex items-center gap-1.5 text-neutral-400">
          <i id="batteryIcon" data-lucide="battery" class="w-4 h-4"></i>
          <span id="batteryPercent" class="font-medium">--%</span>
        </div>
      </div>
    </header>

    <!-- Main Dashboard - Primary Metrics Focus -->
    <main
      class="flex-grow p-4 grid grid-cols-4 gap-4 relative overflow-hidden"
      style="grid-template-rows: 1fr 1fr auto"
    >
      <!-- Background glow -->
      <div
        class="absolute top-1/3 left-1/4 w-[600px] h-[600px] bg-purple-900/20 rounded-full blur-[150px] pointer-events-none"
      ></div>
      <div
        class="absolute bottom-1/3 right-1/4 w-[400px] h-[400px] bg-rose-900/15 rounded-full blur-[120px] pointer-events-none"
      ></div>

      <!-- ═══════════════ POWER - Primary Metric (2 columns) ═══════════════ -->
      <div
        class="col-span-2 row-span-2 relative flex flex-col rounded-3xl bg-gradient-to-br from-purple-950/40 to-neutral-900/60 border border-purple-500/20 p-6 backdrop-blur-sm overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-500 via-violet-500 to-indigo-500"
        ></div>

        <!-- Header -->
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-3">
            <div class="p-2.5 rounded-xl bg-purple-500/20 text-purple-400">
              <i data-lucide="zap" class="w-6 h-6"></i>
            </div>
            <div>
              <span
                class="text-sm font-semibold tracking-widest text-purple-400 uppercase"
                >Power Output</span
              >
              <div class="text-xs text-neutral-500">Primary Metric</div>
            </div>
          </div>
          <span
            id="powerZoneBadge"
            class="text-sm font-bold text-purple-300 bg-purple-500/20 px-3 py-1 rounded-lg"
            >--</span
          >
        </div>

        <!-- Main Values -->
        <div class="flex items-end gap-8 my-4">
          <div class="flex-1">
            <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">
              Instant
            </div>
            <div class="flex items-baseline gap-2">
              <span
                id="power"
                class="text-8xl font-bold tracking-tighter text-white tabular-nums leading-none"
                >--</span
              >
              <span class="text-2xl text-neutral-500 font-medium">W</span>
            </div>
          </div>
          <div class="flex-1">
            <div class="text-xs text-neutral-500 uppercase tracking-wider mb-1">
              3s Average
            </div>
            <div class="flex items-baseline gap-2">
              <span
                id="power3sAvg"
                class="text-7xl font-bold tracking-tighter text-purple-300 tabular-nums leading-none"
                >--</span
              >
              <span class="text-xl text-neutral-500 font-medium">W</span>
            </div>
          </div>
        </div>

        <!-- Lap Power Stats -->
        <div class="flex gap-6 text-sm mb-4 px-1">
          <div>
            <span class="text-neutral-500">Lap Avg:</span>
            <span
              id="lapPower"
              class="text-white font-semibold tabular-nums ml-1"
              >-- W</span
            >
          </div>
          <div>
            <span class="text-neutral-500">Lap NP:</span>
            <span
              id="lapNormalizedPower"
              class="text-white font-semibold tabular-nums ml-1"
              >-- W</span
            >
          </div>
          <div>
            <span class="text-neutral-500">Lap Max:</span>
            <span
              id="lapMaxPower"
              class="text-white font-semibold tabular-nums ml-1"
              >-- W</span
            >
          </div>
        </div>

        <!-- Power Graph -->
        <div class="flex-grow relative mt-2 min-h-[120px]">
          <canvas id="powerGraph" class="w-full h-full"></canvas>
          <div
            class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-purple-950/60 to-transparent pointer-events-none"
          ></div>
        </div>
      </div>

      <!-- ═══════════════ VO2 - Placeholder (1 column) ═══════════════ -->
      <div
        class="relative flex flex-col rounded-3xl bg-gradient-to-br from-cyan-950/40 to-neutral-900/60 border border-cyan-500/20 p-5 backdrop-blur-sm overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-cyan-500 to-teal-500"
        ></div>

        <!-- Header -->
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <div class="p-2 rounded-xl bg-cyan-500/20 text-cyan-400">
              <i data-lucide="wind" class="w-5 h-5"></i>
            </div>
            <span
              class="text-xs font-semibold tracking-widest text-cyan-400 uppercase"
              >VO2</span
            >
          </div>
          <span id="vo2LiveBadge" class="text-xs font-medium text-neutral-500"
            >Pending</span
          >
        </div>

        <!-- Main Value -->
        <div class="flex items-baseline gap-1 my-2">
          <span
            id="vo2"
            class="text-6xl font-bold tracking-tighter text-white tabular-nums"
            >--</span
          >
          <span class="text-lg text-neutral-500 font-medium">ml/kg/min</span>
        </div>

        <!-- VO2 Max Reference -->
        <div class="text-sm text-neutral-500 mb-3">
          <span>% of Max:</span>
          <span id="vo2Percent" class="text-cyan-400 font-semibold ml-1"
            >--%</span
          >
        </div>

        <!-- VO2 Graph -->
        <div class="flex-grow relative min-h-[80px]">
          <canvas id="vo2Graph" class="w-full h-full"></canvas>
        </div>
      </div>

      <!-- ═══════════════ HEART RATE (1 column) ═══════════════ -->
      <div
        class="relative flex flex-col rounded-3xl bg-gradient-to-br from-rose-950/40 to-neutral-900/60 border border-rose-500/20 p-5 backdrop-blur-sm overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-rose-500 to-red-600"
        ></div>

        <!-- Header -->
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <div class="p-2 rounded-xl bg-rose-500/20 text-rose-400">
              <i data-lucide="heart" class="w-5 h-5"></i>
            </div>
            <span
              class="text-xs font-semibold tracking-widest text-rose-400 uppercase"
              >Heart Rate</span
            >
          </div>
          <span
            id="hrLiveBadge"
            class="text-xs font-medium text-rose-400 animate-pulsefast"
            >Live</span
          >
        </div>

        <!-- Main Value -->
        <div class="flex items-baseline gap-1 my-2">
          <span
            id="heartRate"
            class="text-6xl font-bold tracking-tighter text-white tabular-nums"
            >--</span
          >
          <span class="text-lg text-neutral-500 font-medium">BPM</span>
        </div>

        <!-- HR Stats -->
        <div class="flex gap-4 text-sm text-neutral-500 mb-3">
          <div>
            Max:
            <span id="maxHeartRate" class="text-white font-semibold">--</span>
          </div>
          <div>
            Lap:
            <span id="lapHeartRate" class="text-white font-semibold">--</span>
          </div>
        </div>

        <!-- HR Graph -->
        <div class="flex-grow relative min-h-[80px]">
          <canvas id="hrGraph" class="w-full h-full"></canvas>
        </div>
      </div>

      <!-- ═══════════════ CADENCE (1 column) ═══════════════ -->
      <div
        class="relative flex flex-col rounded-3xl bg-gradient-to-br from-blue-950/40 to-neutral-900/60 border border-blue-500/20 p-5 backdrop-blur-sm overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 to-cyan-400"
        ></div>

        <!-- Header -->
        <div class="flex items-center gap-2 mb-2">
          <div class="p-2 rounded-xl bg-blue-500/20 text-blue-400">
            <i data-lucide="rotate-cw" class="w-5 h-5"></i>
          </div>
          <span
            class="text-xs font-semibold tracking-widest text-blue-400 uppercase"
            >Cadence</span
          >
        </div>

        <!-- Main Value -->
        <div class="flex items-baseline gap-1 my-2">
          <span
            id="cadence"
            class="text-6xl font-bold tracking-tighter text-white tabular-nums"
            >--</span
          >
          <span class="text-lg text-neutral-500 font-medium">RPM</span>
        </div>

        <!-- Cadence Stats -->
        <div class="flex gap-4 text-sm text-neutral-500 mb-3">
          <div>
            Avg:
            <span id="avgCadence" class="text-white font-semibold">--</span>
          </div>
          <div>
            Lap:
            <span id="lapCadence" class="text-white font-semibold">--</span>
          </div>
        </div>

        <!-- Cadence Graph -->
        <div class="flex-grow relative min-h-[80px]">
          <canvas id="cadenceGraph" class="w-full h-full"></canvas>
        </div>
      </div>

      <!-- ═══════════════ SPEED (1 column) ═══════════════ -->
      <div
        class="relative flex flex-col rounded-3xl bg-gradient-to-br from-emerald-950/30 to-neutral-900/60 border border-emerald-500/10 p-5 backdrop-blur-sm overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 to-green-500 opacity-60"
        ></div>

        <!-- Header -->
        <div class="flex items-center gap-2 mb-2">
          <div class="p-2 rounded-xl bg-emerald-500/10 text-emerald-400">
            <i data-lucide="gauge" class="w-5 h-5"></i>
          </div>
          <span
            class="text-xs font-medium tracking-widest text-emerald-400/70 uppercase"
            >Speed</span
          >
        </div>

        <!-- Main Value -->
        <div class="flex items-baseline gap-1 my-1">
          <span
            id="speed"
            class="text-5xl font-bold tracking-tighter text-white tabular-nums"
            >--</span
          >
          <span class="text-base text-neutral-500 font-medium">KPH</span>
        </div>

        <!-- Speed Stats -->
        <div class="flex gap-4 text-xs text-neutral-500 mt-auto">
          <div>Avg: <span id="averageSpeed" class="text-white">--</span></div>
          <div>Lap: <span id="lapSpeed" class="text-white">--</span></div>
        </div>
      </div>

      <!-- ═══════════════ SECONDARY METRICS ROW ═══════════════ -->

      <!-- Core Temp -->
      <div
        class="relative flex flex-col rounded-2xl bg-neutral-900/30 border border-white/5 p-4 backdrop-blur-sm"
      >
        <div class="flex items-center gap-2 mb-2">
          <div class="p-1.5 rounded-lg bg-orange-500/10 text-orange-400">
            <i data-lucide="thermometer" class="w-4 h-4"></i>
          </div>
          <span
            class="text-xs font-medium tracking-wider text-neutral-500 uppercase"
            >Core Temp</span
          >
        </div>
        <div class="flex items-baseline gap-1">
          <span
            id="coreTemp"
            class="text-4xl font-bold tracking-tighter text-white tabular-nums"
            >--</span
          >
          <span class="text-sm text-neutral-500">°C</span>
        </div>
        <div
          id="coreTempTrend"
          class="text-xs text-neutral-500 mt-1 flex items-center gap-1"
        >
          --
        </div>
      </div>

      <!-- Last Lap Summary -->
      <div
        class="relative flex flex-col rounded-2xl bg-neutral-900/30 border border-white/5 p-4 backdrop-blur-sm"
      >
        <div class="flex items-center gap-2 mb-2">
          <div class="p-1.5 rounded-lg bg-amber-500/10 text-amber-400">
            <i data-lucide="history" class="w-4 h-4"></i>
          </div>
          <span
            class="text-xs font-medium tracking-wider text-neutral-500 uppercase"
            >Last Lap</span
          >
        </div>
        <div class="grid grid-cols-3 gap-2 text-center">
          <div>
            <div class="text-xs text-neutral-500">Power</div>
            <div
              id="lastLapPower"
              class="text-lg font-bold text-white tabular-nums"
            >
              --
            </div>
          </div>
          <div>
            <div class="text-xs text-neutral-500">Time</div>
            <div
              id="lastLapTime"
              class="text-lg font-bold text-white tabular-nums"
            >
              --
            </div>
          </div>
          <div>
            <div class="text-xs text-neutral-500">Speed</div>
            <div
              id="lastLapSpeed"
              class="text-lg font-bold text-white tabular-nums"
            >
              --
            </div>
          </div>
        </div>
      </div>

      <!-- Environment -->
      <div
        class="relative flex flex-col rounded-2xl bg-neutral-900/30 border border-white/5 p-4 backdrop-blur-sm"
      >
        <div class="flex items-center gap-2 mb-2">
          <div class="p-1.5 rounded-lg bg-sky-500/10 text-sky-400">
            <i data-lucide="cloud-sun" class="w-4 h-4"></i>
          </div>
          <span
            class="text-xs font-medium tracking-wider text-neutral-500 uppercase"
            >Environment</span
          >
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div>
            <div class="text-xs text-neutral-500">Ambient</div>
            <div class="flex items-baseline gap-1">
              <span
                id="temperature"
                class="text-2xl font-bold text-white tabular-nums"
                >--</span
              >
              <span class="text-xs text-neutral-500">°C</span>
            </div>
          </div>
          <div>
            <div class="text-xs text-neutral-500">Elevation</div>
            <div class="flex items-baseline gap-1">
              <span
                id="elevation"
                class="text-2xl font-bold text-white tabular-nums"
                >--</span
              >
              <span class="text-xs text-neutral-500">m</span>
            </div>
          </div>
        </div>
      </div>

      <!-- GPS/Grade -->
      <div
        class="relative flex flex-col rounded-2xl bg-neutral-900/30 border border-white/5 p-4 backdrop-blur-sm"
      >
        <div class="flex items-center gap-2 mb-2">
          <div class="p-1.5 rounded-lg bg-teal-500/10 text-teal-400">
            <i data-lucide="mountain" class="w-4 h-4"></i>
          </div>
          <span
            class="text-xs font-medium tracking-wider text-neutral-500 uppercase"
            >Grade</span
          >
        </div>
        <div class="flex items-baseline gap-1 mb-2">
          <span id="grade" class="text-3xl font-bold text-white tabular-nums"
            >--</span
          >
          <span class="text-sm text-neutral-500">%</span>
        </div>
        <div class="text-xs text-neutral-500 flex gap-2 mt-auto">
          <span
            >Lat:
            <span id="latitude" class="text-neutral-400 tabular-nums"
              >--</span
            ></span
          >
          <span
            >Lng:
            <span id="longitude" class="text-neutral-400 tabular-nums"
              >--</span
            ></span
          >
        </div>
      </div>
    </main>

    <!-- Minimal Footer -->
    <footer
      class="flex-none px-6 py-2 border-t border-white/5 bg-neutral-950 flex justify-between items-center text-neutral-600 text-xs"
    >
      <span id="lastUpdate" class="uppercase tracking-widest font-medium"
        >--</span
      >
      <span>Braven Performance Lab v1.0</span>
    </footer>

    <script src="/js/websocket-client.js"></script>
    <script src="/js/dashboard-renderer.js"></script>
    <script>
      // Initialize Lucide icons
      lucide.createIcons();

      // Initialize the dashboard
      const client = new BravenWebSocketClient();
      const renderer = new DashboardRenderer();

      client.onData((data) => {
        renderer.update(data);
      });

      client.onStatusChange((connected) => {
        renderer.setConnectionStatus(connected);
      });

      client.connect();
    </script>
  </body>
</html>
